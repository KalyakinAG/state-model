# state-model

Модель состояния - DSL модели объекта и формы, поддержка шаблона MVC

## Пример описания параметров состояния

```
	//  Параметры состояния
	///////////////////////////////////////////////////////////
	МодельСостояния.ПараметрСостояния("ТипОперации")
		.Параметр("ВидОперации")
		.Выражение("ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Параметры.ВидОперации, 'ТипОперацииБюджетирование')")
	;
	МодельСостояния.ПараметрСостояния("ЭтоВнутренняяОперация").ТипБулево()
		.Параметр("ТипОперации")
		.Выражение("(Ложь
		|	ИЛИ Параметры.ТипОперации = ПредопределенноеЗначение('Перечисление._ДемоТипыОперацийБюжетирование.ПеремещениеМеждуМестамиХраненияСредств')
		|	ИЛИ Параметры.ТипОперации = ПредопределенноеЗначение('Перечисление._ДемоТипыОперацийБюжетирование.КонвертацияВалюты')
		|)")
	;
	МодельСостояния.ПараметрСостояния("БанковскийСчет")
		.Параметр("Отбор.Владелец", "Организация")
	;
	МодельСостояния.ПараметрСостояния("СчетКонтрагента")
		.Параметр("Отбор.Владелец", "Контрагент")
			.Использование()
				.Параметр("ЭтоВнутренняяОперация")
				.Выражение("НЕ Параметры.ЭтоВнутренняяОперация")
		.Параметр("Отбор.Владелец", "Организация")
			.Использование()
				.Параметр("ЭтоВнутренняяОперация")
				.Выражение("Параметры.ЭтоВнутренняяОперация")
	;
	МодельСостояния.ПараметрСостояния("ДоговорКонтрагента")
		.Параметр("Отбор.Организация", "Организация")
		.Параметр("Отбор.Владелец", "Контрагент")
	;
	МодельСостояния.ПараметрСостояния("СуммаВзаиморасчетов").НаКлиенте()
		.ПриИзменении()
	;
	МодельСостояния.ПараметрСостояния("СуммаДокумента").НаКлиенте()
		.Параметр("СуммаВзаиморасчетов")
		.Выражение("Параметры.СуммаВзаиморасчетов * 2")
	;
	МодельСостояния.ПараметрСостояния("ДвиженияОперации.СуммаВзаиморасчетов").НаКлиенте()
		.Параметр("Сумма", "СуммаВзаиморасчетов")
		.Выражение("Параметры.Сумма * 2")
	;
	МодельСостояния.ПараметрСостояния("ЭтоНовый").НаКлиенте()
		.Параметр("Ссылка", , Ложь)
		.Выражение("ЗначениеЗаполнено(Параметры.Ссылка)")
	;

```

## Пример описания элементов формы

```
	//  Элементы формы
	///////////////////////////////////////////////////////////
	МодельСостояния.ЭлементФормы()
		.Свойство("Заголовок")
			.Параметр("Дата")
			.Параметр("Номер")
			.Параметр("Проведен")
			.Параметр("ПометкаУдаления")
			.Параметр("ЭтоНовый")
			.Выражение("СтрШаблон('Заявка на операцию %1 от %2. %3', Параметры.Номер, Параметры.Дата, 
			|	?(Параметры.Проведен, 'Проведен', 
			|		?(Параметры.ПометкаУдаления, 'Помечен на удаление', 
			|			?(Параметры.ЭтоНовый, 'Новый', 'Записан')
			|		)
			|	)
			|)
			|")
	;
	МодельСостояния.ЭлементФормы("ВалютаДокумента")
		.Свойство("Видимость")
			.Параметр("ВалютаВзаиморасчетов")
			.Параметр("ВалютаДокумента")
			.Выражение("Параметры.ВалютаВзаиморасчетов <> Параметры.ВалютаДокумента")
	;
```

## Диаграмма последовательности MVC

![Диаграмма последовательности MVC](https://github.com/KalyakinAG/state-model/blob/main/doc/mvc-seq-diagram.svg)

## Модель данных

![Модель данных](https://github.com/KalyakinAG/state-model/blob/main/doc/data-model.svg)

## Цикл расчета параметров состояния

![Цикл расчета параметров состояния](https://github.com/KalyakinAG/state-model/blob/main/doc/object-model-calc.svg)

## Цикл расчета элементов формы

![Цикл расчета элементов формы](https://github.com/KalyakinAG/state-model/blob/main/doc/form-model-calc.svg)
